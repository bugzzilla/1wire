#! /bin/bash

wire2eth="172.23.81.35:3999"
mountpoint="/mnt/1wire"
virtualport="/dev/vport0"

/usr/local/bin/socat -d -d -d -ly PTY,link=$virtualport,raw,b9600,echo=0 tcp:$wire2eth < /dev/null &
sleep 3
echo -n -e "\xC1\xE3\xC5" > $virtualport
echo -n -e "\xA1" > $virtualport
echo -n -e "\xC5" > $virtualport
echo -n -e "\x17\x45\x5B\x0F\x91" > $virtualport
/opt/owfs/bin/owfs -d $virtualport -m $mountpoint --allow_other --error_level 9 --error_print 0

echo "Sensor:Temperature";

for f in `ls /mnt/1wire/|grep 28.`;
        do
                echo -n "${f}:";
                cat /mnt/1wire/${f}/temperature;
                echo ;
        done

pkill -f /opt/owfs/bin/owfs > /dev/null
pkill -f /usr/local/bin/socat > /dev/null