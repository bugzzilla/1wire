#! /bin/bash

owfs="/opt/owfs/bin/owfs"
socat="/usr/local/bin/socat"
wire2eth_controller="172.23.81.35:3999"
owfs_mount_point="/mnt/1wire"
socat_virtual_port="/dev/vport0"

$socat -d -d -d -ly PTY,link=$socat_virtual_port,raw,b9600,echo=0 tcp:$wire2eth_controller < /dev/null &
sleep 3
echo -n -e "\xC1\xE3\xC5" > $socat_virtual_port
echo -n -e "\xA1" > $socat_virtual_port
echo -n -e "\xC5" > $socat_virtual_port
echo -n -e "\x17\x45\x5B\x0F\x91" > $socat_virtual_port
$owfs -d $socat_virtual_port -m $owfs_mount_point --allow_other --error_level 9 --error_print 0

echo "Sensor:Temperature";

for f in `ls $owfs_mount_point/|grep 28.`;
        do
                echo -n "${f}:";
                cat $owfs_mount_point/${f}/temperature;
                echo ;
        done

pkill -f $owfs > /dev/null
pkill -f $socat > /dev/null
